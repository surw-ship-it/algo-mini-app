<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>USDT ADS Mini App</title>

<!-- Telegram Mini App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Monetag SDK -->
<script
  src="https://libtl.com/sdk.js"
  data-zone="10483596"
  data-sdk="show_10483596">
</script>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  background: #0f172a;
  color: #fff;
  font-family: Arial;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.card {
  width: 90%;
  max-width: 360px;
  background: #020617;
  border-radius: 14px;
  padding: 20px;
  text-align: center;
  position: relative;
}
.balance { color: #22c55e; margin: 10px 0; }
button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border: none;
  border-radius: 10px;
  background: #2563eb;
  color: #fff;
  font-size: 16px;
}
#withdrawBtn {
  position: absolute;
  top: 10px;
  right: 10px;
  width: auto;
  padding: 6px 12px;
}
</style>
</head>

<body>

<div class="card">
  <h2>USDT ADS</h2>

  <div class="balance">
    Bakiye: <span id="balance">0.000</span> USDT
  </div>

  <div>Reklam: <span id="counter">0</span> / 5</div>

  <button id="watchAd">ðŸŽ¬ Reklam Ä°zle</button>
  <button id="withdrawBtn">ðŸ’° Ã‡ekim</button>
</div>

<script>
/* TELEGRAM */
Telegram.WebApp.ready();
Telegram.WebApp.expand();
const telegramId = Telegram.WebApp.initDataUnsafe.user.id;

/* SUPABASE */
const supabase = supabaseJs.createClient(
  "https://slfiayhyouktjoakvhcu.supabase.co",
  "ANON_KEYÄ°N_BURADA"
);

/* STATE */
let balance = 0;
let counter = 0;

/* INIT USER */
async function initUser() {
  const { data } = await supabase
    .from("users_demo")
    .select("*")
    .eq("telegram_id", telegramId)
    .single();

  if (!data) {
    await supabase.from("users_demo").insert({
      telegram_id: telegramId,
      balance: 0,
      counter: 0
    });
  } else {
    balance = data.balance;
    counter = data.counter;
  }

  updateUI();
}

function updateUI() {
  document.getElementById("balance").innerText = balance.toFixed(3);
  document.getElementById("counter").innerText = counter;
}

initUser();

/* REKLAM */
document.getElementById("watchAd").onclick = () => {
  if (typeof window.show_10483596 !== "function") {
    alert("âŒ Reklam henÃ¼z yÃ¼klenmedi");
    return;
  }

  // MUTLAKA BÃ–YLE Ã‡AÄžRILIR
  window.show_10483596();

  counter++;

  if (counter >= 5) {
    balance += 0.005;
    counter = 0;
    alert("ðŸŽ‰ 0.005 USDT kazandÄ±n!");
  }

  updateUI();

  supabase
    .from("users_demo")
    .update({ balance, counter })
    .eq("telegram_id", telegramId);
};
</script>

</body>
</html>
