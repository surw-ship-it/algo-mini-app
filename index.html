<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorand Demo</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <div id="telegram-auth-form"></div>

    <div id="content">
        <h1>Algorand Demo</h1>
        <p>Merhaba! Bu, Algorand'Ä± deneme yapmak iÃ§in bir demo uygulamasÄ±dÄ±r.</p>

        <button id="openWithdraw">Ã‡ekimi AÃ§</button>
        <button id="openSpinner">Ã‡arkÄ± DÃ¶ndÃ¼r</button>
        <button id="watchAd">ReklamÄ± Ä°zle</button>

        <div id="balance">0.00 ALGO</div>

        <div id="links">
            <!-- Linkler buraya yerleÅŸtirilecek -->
        </div>
    </div>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        let balance = Number(localStorage.getItem("balance")) || 0;
        let dailyAds = Number(localStorage.getItem("dailyAds")) || 30;
        let lastDay = localStorage.getItem("lastAdDay") || new Date().toDateString();

        const balanceEl = document.getElementById("balance");
        balanceEl.innerText = balance.toFixed(3);

        /* ADS */
        function resetAds() {
            const t = new Date().toDateString();
            if (t !== lastDay) {
                dailyAds = 30;
                lastDay = t;
                localStorage.setItem("dailyAds", 30);
                localStorage.setItem("lastAdDay", t);
            }
        }
        resetAds();
        adCounter.innerText = `GÃ¼nlÃ¼k reklam hakkÄ±nÄ±z: ${dailyAds} / 30`;

        /* LINKLER */
        const links = [
            "https://otieu.com/4/10484834",
            "https://otieu.com/4/10498410",
            "https://otieu.com/4/10498413",
            "https://otieu.com/4/10498415",
            "https://otieu.com/4/10498414",
            "https://otieu.com/4/10513346",
            "https://otieu.com/4/10513352",
            "https://otieu.com/4/10513355",
            "https://otieu.com/4/10513358",
            "https://otieu.com/4/10513360"
        ];

        const linksDiv = document.getElementById("links");
        const COOLDOWN = 43200000;

        function format(ms) {
            const t = Math.max(0, ms);
            const h = Math.floor(t / 3600000);
            const m = Math.floor((t % 3600000) / 60000);
            return `${h}sa ${m}dk`;
        }

        function renderLinks() {
            linksDiv.innerHTML = "";
            links.forEach((url, i) => {
                const wrap = document.createElement("div");
                wrap.className = "link-wrap";
                const btn = document.createElement("button");
                const timer = document.createElement("div");
                timer.className = "timer";

                const last = Number(localStorage.getItem("link_" + i));
                const left = last ? COOLDOWN - (Date.now() - last) : 0;

                btn.innerText = `ðŸ”— Link ${i + 1} (+0.025 ALGO)`;

                if (left > 0) {
                    btn.disabled = true;
                    timer.innerText = `Kalan sÃ¼re: ${format(left)}`;
                } else {
                    btn.onclick = () => {
                        localStorage.setItem("link_" + i, Date.now());
                        localStorage.setItem("pendingReward", i);
                        location.href = url;
                    };
                }

                wrap.appendChild(btn);
                if (left > 0) wrap.appendChild(timer);
                linksDiv.appendChild(wrap);
            });
        }

        setInterval(renderLinks, 60000);
        renderLinks();

        /* WITHDRAW */
        openWithdraw.onclick = () => {
            popupBalance.innerText = balance.toFixed(3) + " ALGO";
            withdrawPopup.style.display = "flex";
        };
        function closeWithdraw() {
            withdrawPopup.style.display = "none";
        }
        function isAlgorandAddress(a) {
            return /^[A-Z2-7]{58}$/.test(a);
        }
        function sendWithdraw() {
            const w = wallet.value.trim();
            const a = parseFloat(amount.value);
            if (!isAlgorandAddress(w)) {
                alert("YalnÄ±zca Algorand adresi giriniz");
                return;
            }
            if (isNaN(a) || a < 12) {
                alert("Minimum Ã§ekim 12 ALGO");
                return;
            }
            if (a > balance) {
                alert("Yetersiz bakiye");
                return;
            }
            balance -= a;
            localStorage.setItem("balance", balance);
            balanceEl.innerText = balance.toFixed(3);
            closeWithdraw();
            alert("Ã‡ekim talebi alÄ±ndÄ± (demo)");
        }

        /* Ã‡ARK */
        const spinnerPopup = document.getElementById("spinnerPopup");
        const winPopup = document.getElementById("winPopup");
        const winText = document.getElementById("winText");

        document.getElementById("openSpinner").onclick = function () {
            spinnerPopup.style.display = "flex";
        };

        function closeSpinner() {
            spinnerPopup.style.display = "none";
        }

        function spin() {
            if (spinning) return;
            if (balance < spinCost) {
                alert("Bakiye yetersiz");
                return;
            }
            spinning = true;
            balance -= spinCost;
            localStorage.setItem("balance", balance);
            balanceEl.innerText = balance.toFixed(3);

            const index = weightedPrize();
            const deg = 360 * 5 - (index * 360 / prizes.length + 360 / prizes.length / 2);
            canvas.style.transition = "transform 4s cubic-bezier(.17,.67,.3,1)";
            canvas.style.transform = `rotate(${deg}deg)`;

            setTimeout(() => {
                const p = prizes[index];
                if (p.amount > 0) {
                    balance += p.amount;
                    localStorage.setItem("balance", balance);
                    balanceEl.innerText = balance.toFixed(3);
                }
                winText.innerHTML = `ðŸŽ‰ Tebrikler ${p.label} kazandÄ±nÄ±z`;
                winPopup.style.display = "flex";
                setTimeout(() => winPopup.style.display = "none", 3000);
                spinning = false;
            }, 4200);
        }

        /* REKLAM */
        watchAd.onclick = async () => {
            if (dailyAds <= 0) {
                alert("GÃ¼nlÃ¼k limit doldu");
                return;
            }
            await show_10483596();
            dailyAds--;
            balance += 0.1;
            localStorage.setItem("balance", balance);
            balanceEl.innerText = balance.toFixed(3);
            adCounter.innerText = `GÃ¼nlÃ¼k reklam hakkÄ±nÄ±z: ${dailyAds} / 30`;
        };

        /*  SAYAC */
        const adCounter = document.getElementById("adCounter");
        adCounter.innerText = `GÃ¼nlÃ¼k reklam hakkÄ±nÄ±z: ${dailyAds} / 30`;

        /*  Ã‡ARK Ä°Ã‡Ä°NDEKÄ° Ã–DÃœLLER */
        const prizes = [
            { label: "Yeniden Dene", amount: 0, confetti: false, weight: 999999 },
            { label: "0.05 ALGO", amount: 0.05, confetti: true, weight: 800 },
            { label: "0.1 ALGO", amount: 0.1, confetti: true, weight: 800 },
            { label: "0.2 ALGO", amount: 0.2, confetti: true, weight: 800 },
            { label: "0.5 ALGO", amount: 0.5, confetti: true, weight: 800 },
            { label: "1 ALGO", amount: 1, confetti: true, weight: 800 }
        ];

        function weightedRandom(arr) {
            let total = arr.reduce((p, c) => p + c.weight, 0);
            let rand = Math.random() * total;
            let cumSum = 0;
            for (let i = 0; i < arr.length; i++) {
                cumSum += arr[i].weight;
                if (rand < cumSum) return arr[i];
                rand -= arr[i].weight;
            }
            return arr[arr.length - 1];
        }

        function getPrize() {
            return weightedRandom(prizes);
        }
    </script>

</body>
</html>
